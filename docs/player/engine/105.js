"use strict";(self.webpackChunk_reneos_3d_player_engine=self.webpackChunk_reneos_3d_player_engine||[]).push([[105,614],{30:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var s=a(308);class i extends s.Object3D{static get IsElement(){return!0}constructor(e){super(),this.prototypes=["base"],this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data=e,this.type="element",this.data.actions||(this.data.actions=[]),e.position&&(this.position.copy(e.position),this.data.position=this.position.clone()),e.rotation&&(this.rotation.setFromVector3(e.rotation,"XYZ"),this.data.rotation=this.rotation.clone()),e.scale&&(this.scale.copy(e.scale),this.data.scale=this.scale.clone()),this.visible=e.view||!1}addAction(e){this.data.actions.push(e)}get actions(){return this.data.actions}get model(){return this}get visible(){return super.visible}set visible(e){super.visible=e}addElement(e,t,a,s){a===this?(this.add(t),e.position&&t.position.copy(s[e.position]||e.position),e.scale&&t.scale.copy(s[e.scale]||e.scale)):a.addElement(e,t,a,s)}}const n=i},127:(e,t,a)=>{a.d(t,{A:()=>h});var s=a(308),i=a(74),n=a(351),o=a(404);let r;new s.Vector2;const c=new n.A;let l;class d{static Init(e,t){l=t,r=new i.B({element:e}),r.setSize(window.innerWidth,window.innerHeight),r.domElement.style.position="absolute",r.domElement.style.top="0px",o.A.AddToUpdate(d.Render)}static async AddElement(e,t){const a=await l(t),s=new i.v(a);return c.emit("add",s,e),s}static AddLabel(e,t){const a=new i.v(e);return a.position.set(0,0,0),a.center.set(.5,.5),a.layers.set(0),a}static AddHookLine(e,t){}static UpdateHook(e){let t=function(e,t){let a=e.getBoundingClientRect(),i=e.offsetParent?e.offsetParent.getBoundingClientRect():{left:0,top:0},n=(a.left-i.left+a.width/2)/window.innerWidth*2-1,o=-(a.top-i.top+a.height/2)/window.innerHeight*2+1,r=new s.Vector3(n,o,-2);r.unproject(t);let c=r.sub(t.position).normalize();return t.position.clone().add(c.multiplyScalar(3))}(e.div,o.A.Camera,o.A.Scene);e.points[1].copy(t),e.line.geometry.setFromPoints(e.points)}static Render(){r.render(o.A.Scene,o.A.Camera)}}const h=new Proxy(d,{get:(e,t)=>t in e?e[t]:c[t]})},140:(e,t,a)=>{a.d(t,{A:()=>p});var s=a(404),i=a(586),n=a(351),o=a(539);const r=[],c=[];let l,d=!1;const h=new n.A;class u{static get Processed(){return d}static get Current(){return l}static AddSlides(e){for(let t=0;t<e.length;t++){const a={name:"",children:[],camera:{},scene:{},actions:[],...e[t]},i=s.A.FindStates(a.uid);for(let e=0;e<i.length;e++){const t=i[e];a.children.push({model:t,...t.states[a.uid]})}r.push(a)}return h.emit("add",r),r}static async GoTo(e){const t="number"==typeof e?r[e]:r.find((t=>t.uid===e));t&&void 0!==t.uid&&(c[c.length-1]!==t.uid&&c.push(t.uid),await u.Activate(t))}static async GoToNext(){const e=r.findIndex((e=>e===l));await u.GoTo(e+1)}static async GoToBack(){c.pop(),await u.GoTo(c[c.length-1])}static async Activate(e,t){d||(d=!0,t?(await u.SlideOut(t,e.children),h.emit("activate",e,t),await u.SlideIn(e,t.children)):(h.emit("activate",e,t),await u.SlideIn(e)),h.emit("change",e,t),d=!1)}static async SlideIn(e,t=[]){console.time("SlideIn");const a=[],n=[];for(let s=0;s<e.children.length;s++){const i=e.children[s];t.findIndex((e=>e.model.uid===i.model.uid))>=0?n.push(i):a.push(i)}try{if(e.camera?.path&&e.camera?.path!==s.A.Camera?.path){const t=e.camera.path.split("."),a=s.A.Find(t);s.A.SetCamera(a),a.updateProjectionMatrix()}}catch(e){console.warn(e.message)}const o=[...a,...n];await Promise.all([i.A.Execute(o,"slide.in.before"),i.A.Run(e._actions,e,"slide.in.before")]),await i.A.Execute(a,"enable.on"),await Promise.all([i.A.Execute(o,"slide.in"),i.A.Run(e._actions,e,"slide.in")]);for(let t=0;t<o.length;t++)u.ActivateState(o[t],e.uid);await Promise.all([i.A.Execute(o,"slide.in.after"),i.A.Run(e._actions,e,"slide.in.after")]),console.timeEnd("SlideIn")}static ActivateState(e,t){const{position:a=e.model.position,rotation:s={x:e.model.rotation.x,y:e.model.rotation.y,z:e.model.rotation.z},scale:i=e.model.scale,actions:n=[],model:r,properties:c={},...l}=e;r.state=e,r.position.copy(a),r.rotation.setFromVector3(s,"XYZ"),r.scale.copy(i),Object.keys(l).forEach((async e=>{const t=e.split("."),a=l[e];let s=t[0],i=r;for(let e=0;e<t.length-1;e++)i=i[t[e]],s=t[e+1];i[s]=await o.$7.CreateElement(a)})),"visible"in l||(r.visible=!0)}static async SlideOut(e,t){const a=[],s=[];for(let i=0;i<e.children.length;i++){const n=e.children[i];t.findIndex((e=>e.uid===n.uid))>=0?a.push(n):s.push(n)}const n=[...s,...a];await Promise.all([i.A.Execute(n,"slide.out"),i.A.Run(e._actions,e,"slide.out")]),await i.A.Execute(s,"disable.on");for(let t=0;t<s.length;t++)u.DectivateState(s[t],e)}static DectivateState(e,t){e.visible=!1}}const p=new Proxy(u,{get:(e,t)=>t in e?e[t]:h[t]})},173:(e,t,a)=>{var s;a.r(t),a.d(t,{ActionsManager:()=>d.A,AssetsManager:()=>o.A,BaseElement:()=>n.C6,CssManager:()=>h.A,ElementModel:()=>n.Kx,Factory:()=>n.$7,MouseManager:()=>l.A,ProjectManager:()=>c.A,SlidesManager:()=>r.A,THREE:()=>s||(s=a.t(i,2))});var i=a(308),n=a(539),o=a(304),r=a(140),c=a(404),l=a(337),d=a(586),h=a(127)},304:(e,t,a)=>{a.d(t,{A:()=>l});const s=class{constructor(e){this.data=e,this.resource=null,this.promise=null,this.elements=[]}async load(){}updateResource(e,t){this.resource=e,this.applyData(t||this.data)}get uid(){return this.data.uid}};var i=a(92);var n=a(308);var o=a(231);const r=new Map,c={gltf:class extends s{constructor(e){super(e)}async load(){await new Promise((e=>{(new i.B).load(this.data.url,(async t=>{let a;this.resource=t.scene.children.length>1?t.scene:t.scene.children[0],this.data.transform?.position&&this.resource.position.copy(this.data.transform.position),this.data.transform?.rotation&&this.resource.rotation.set(this.data.transform.rotation.x,this.data.transform.rotation.y,this.data.transform.rotation.z,"XYZ"),this.data.transform?.scale&&this.resource.scale.copy(this.data.transform.scale),this.data.envMap&&(a=await l.GetResource(this.data.envMap)),this.resource.traverse((e=>{e.isMesh&&(this.data.envMap&&(e.material.envMap=a,e.material.envMapIntensity=.75),e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())})),e()}))}))}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){super.updateResource(e,t);for(let t=0;t<this.elements.length;t++){const t=this.elements,a=t.element.children.find((e=>e.uid===this.data.uid));a!==e&&(t.element.remove(a),t.element.add(this.resource.clone())),this.applyData(t.data)}}async applyData(e){let t;this.resource.position.copy(e.transform?.position||{x:0,y:0,z:0}),this.resource.rotation.setFromVector3(e.transform?.rotation||{x:0,y:0,z:0},"XYZ"),this.resource.scale.copy(e.transform?.scale||{x:1,y:1,z:1}),e.transform?.quaternion&&this.resource.quaternion.copy(e.transform.quaternion),e.envMap&&(t=await l.GetAsset(e.envMap).resource),this.resource.traverse((a=>{a.isMesh&&(e.envMap&&(a.material.envMap=t),a.castShadow=e.shadow?.cast||!1,a.receiveShadow=e.shadow?.receive||!1,a.geometry.computeBoundingBox())}))}destroy(){for(let e=0;e<this.elements.length;e++){const e=this.elements;e.elements.children.find((e=>e.uid===this.data.uid))&&e.elements.remove(this.resource)}}},texture:class extends s{constructor(e){super(e)}async load(){const e=new n.TextureLoader;this.resource=await e.load(this.data.url)}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find((e=>e.uid===this.data.uid))!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}destroy(){this.element.children.find((e=>e.uid===this.data.uid))&&this.element.remove(this.resource)}},hdr:class extends s{constructor(e){super(e)}load(){return new Promise((e=>{(new o.Y).load(this.data.url,(t=>{t.mapping=n.EquirectangularReflectionMapping,this.resource=t,e()}))}))}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find((e=>e.uid===this.data.uid))!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}destroy(){this.element.children.find((e=>e.uid===this.data.uid))&&this.element.remove(this.resource)}},material:class extends s{constructor(e){super(e),this.resource=new n.MeshStandardMaterial,this.elements=[]}async load(){Object.keys(this.data.textures).forEach((async e=>{this.resource[e]=await l.GetResource(this.data.textures[e].uid)})),Object.keys(this.data.properties).forEach((async e=>{this.resource[e]=this.data.properties[e]}))}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){for(let a=0;a<this.elements.length;a++){const a=this.elements;a.element.children.find((e=>e.uid===this.data.uid))!==e&&(a.element.remove(this.resource),this.resource=e,a.element.add(this.resource.clone())),this.applyData(t),this.applyData(a.data)}}}},l=class{static GetAsset(e){return r.get(e)}static GetAssets(e){const t=new Set(e);return[...r.values()].filter((e=>t.has(e.uid)))}static GetResource(e){const t=r.get(e);return t.resource?t.resource:(t.promise||(t.promise=new Promise((async e=>{await t.load(),e(t.resource)}))),t.promise)}static async Init(e){for(let t=0;t<e.length;t++){const a=e[t],s=new(0,c[a.type])(a);r.set(s.uid,s)}const t=[];for(const[e,a]of r.entries())t.push(a.load());await Promise.allSettled(t)}static RemoveAsset(e){r.has(e.uid)&&(r.get(e.uid).destroy(),r.delete(e.uid))}}},337:(e,t,a)=>{a.d(t,{A:()=>D});var s=a(308),i=a(351);function n(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}var o=a(24);let r,c;const l=class{static MoveTo(e,t){const a={position:new s.Vector3,time:1e3,...e,control:!1},i={position:new s.Vector3,time:1e3,...t,control:!1};r.enabled=!1;const n=Workspace.Camera.position.clone(),o=r.target.clone();a.control=a.time>i.time,i.control=i.time>=a.time;const c=new Tween(n).to(a.position,a.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(n),Workspace.Camera.updateProjectionMatrix(),r.update()})).onComplete((()=>{a.control&&(r.enabled=!0),tweengroup.remove(c)})).start(),l=new Tween(o).to(i.position,i.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{r.target.copy(o),r.getPolarAngle()>r.maxPolarAngle&&r.target.setY(center.y+Math.cos(r.maxPolarAngle)*distance)})).onComplete((()=>{i.control&&(r.enabled=!0),tweengroup.remove(l)})).start();tweengroup.add(c,l)}static SetState(e){r.enabled=e}static Target(e){r.target.copy(e)}static Init({canvas:e},t,a){r&&a.remove(r),r=new o.N(t,e),r.enabled=!0,r.enableDamping=!0,r.dampingFactor=.25,r.screenSpacePanning=!1,r.minDistance=.01,r.maxDistance=500}static ChangeCamera(e){r.object=e}static get Transformer(){return c}static Select(e){e?c.attach(e):c.detach()}static Update(e){r.update(e)}static FitTo({center:e,radius:t}){const a=s.MathUtils.degToRad(Workspace.Camera.fov),i=t/Math.sin(a/2),n=(new s.Vector3).subVectors(Workspace.Camera.position,e).normalize(),o=e.clone().add(n.multiplyScalar(i)),c=Workspace.Camera.position.clone();r.enabled=!1;const l=r.target.clone(),d=new Tween(l).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate((()=>{r.target.copy(l),r.getPolarAngle()>r.maxPolarAngle&&r.target.setY(e.y+Math.cos(r.maxPolarAngle)*distance)})).start(),h=new Tween(c).to(o,1e3).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(c);const t=Workspace.Camera.position.distanceTo(e);t<r.minDistance?Workspace.Camera.position.copy(e.clone().add(n.clone().multiplyScalar(r.minDistance))):t>r.maxDistance&&Workspace.Camera.position.copy(e.clone().add(n.clone().multiplyScalar(r.maxDistance))),Workspace.Camera.updateProjectionMatrix(),r.update()})).onComplete((()=>{r.enabled=!0,tweengroup.remove(h,d)})).start();tweengroup.add(h,d)}};var d=a(140);const h=new s.Raycaster,u=new i.A;let p,m,f,y;const g={x:0,y:0};let w,v=.03,A=.03,b=.01,x=.01,E=window.innerWidth/2,C=window.innerHeight/2;function M(e){}function S(e){g.x=e.clientX,g.y=e.clientY,w=Date.now()}function P(e){if(d.A.Processed)return;if(Math.abs(g.x-e.clientX)>10||Math.abs(g.y-e.clientY)>10||Date.now()-w>500)return;const t=e.clientX/window.innerWidth,a=-e.clientY/window.innerHeight,i=new s.Vector2;i.x=2*t-1,i.y=2*a+1,h.setFromCamera(i,m);const o=h.intersectObjects(p.children,!0);if(0===o.length)return;const r=[];for(let e=0;e<o.length;e++){const t=n(o[e].object);if(t.visible&&!r.includes(t))return r.push(t),void u.emit("click",t)}}const D=new Proxy(class{static get Control(){return l}static Init(e,t,a,s,i){const n={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...i};p=s,f=a,m=t,y=e,v=n.camera.movespeed.x,A=n.camera.movespeed.y,b=n.camera.range.x,x=n.camera.range.y,E=window.innerWidth/2,C=window.innerHeight/2,e.addEventListener("click",P.bind(null)),e.addEventListener("mousemove",M,!1),e.addEventListener("mousedown",S,!1)}static Update(e){}static SetCamera(e){m=e}},{get:(e,t)=>t in e?e[t]:u[t]})},351:(e,t,a)=>{a.d(t,{A:()=>s});const s=class{constructor(){this._events={"*":[]}}subs(e,t,a){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:a,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const a=this._events[e];if(a){for(let e=a.length-1;e>=0;e--)a[e].handler===t&&a.splice(e,1);0===a.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const a=[];this._events[e]&&a.push(...this._events[e]),this._events["*"].length&&a.push(...this._events["*"].map((t=>({handler:t.handler.bind(this,e),once:t.once}))));for(let e=a.length-1;e>=0;e--){const s=a[e];s.handler.apply(null,t),s.once&&a.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}},404:(e,t,a)=>{a.d(t,{A:()=>x});var s=a(308),i=a(351),n=a(539),o=a(304),r=a(337),c=a(586);a(140);let l,d,h,u,p,m,f,y=[];const g=new i.A,w=[];function v(e){for(let t=0;t<y.length;t++)y[t](e);u.render(h,m)}class A{static get Block(){return w}static get Root(){return p}static get Scene(){return h}static get Camera(){return m}static get Canvas(){return l}static get Renderer(){return u}static Init(e){l=e,d=new s.Clock,h=new s.Scene,u=new s.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const t=l.clientWidth,a=l.clientHeight;u.setSize(t,a,!1),u.setPixelRatio(window.devicePixelRatio),u.shadowMap.enabled=!0,u.shadowMap.type=s.PCFSoftShadowMap,p=new s.Object3D,h.add(p),f=p.position.clone()}static async Start(){m=new s.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),m.uid="EditorCamera",h.add(m),m.position.set(0,10,20),u.setAnimationLoop(v),m.layers.enable(1),r.A.Init(u.domElement,m,h,p),r.A.on("click",(e=>{c.A.Run([...e.actions,...e.state.actions],e,"mouse.click")})),y.push(r.A.Update)}static AddToUpdate(e){y.push(e)}static Collect(e,t,a=[]){for(let s=0;s<e.length;s++){const i=e[s];i.isElement&&i.states[t]&&a.push(i),i.children.length&&A.Collect(i.children,t,a)}}static FindStates(e){const t=[];return A.Collect(w,e,t),t}static Find(e){let t={children:w};for(let a=0;a<e.length;a++)t=t.children.find((t=>t.uid===e[a]));return t}static SetCamera(e){m.visible=!1,m=e,m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),m.visible=!0,r.A.SetCamera(m)}static async Builds(e){const t={};for(let a=e.length-1;a>=0;a--){const s=e[a],i=await A.Build(e,s,t);w.push(i)}console.log(p)}static async Build(e,t,a){if(!t)return;if(a[t.uid])return a[t.uid];const s=t.parent;let i=a[s];i||(i=await A.Build(e,e.find((e=>e.uid===s)),a));const o=a[t.uid]=await n.$7.BuildElement(t,i||p);return o.name=t.name||t.uid,o.states=t.states||{},o}static FindBlock(e){return w.find((t=>t.uid===e))}static FindElement(e){let t=w.find((t=>t.uid===e[0]));for(let a=1;a<e.length;a++)t=t.children.find((t=>t.uid===e[a]));return t}static async SetAsset(e,t){const a=await o.A.GetAsset({uid:t.uid}),s=e.split(".");let i=w.find((e=>e.uid===s[0]));for(let e=1;e<s.length;e++)i=i.children.find((t=>t.uid===s[e]));i.addAsset(t,a)}static RemoveAsset(e,t){const a=e.split(".");let s=w.find((e=>e.uid===a[0]));for(let e=1;e<a.length;e++)s=s.children.find((t=>t.uid===a[e]));s.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let a=w;for(let e=0;e<t.length-1;e++){const s=a.find((a=>a.uid===t[e]));a=s.children}const s=a.findIndex((t=>t.path===e));if(s>=0){const e=a.splice(s,1);e[0].parent.remove(e[0])}}}const b=new Proxy(A,{get:(e,t)=>t in e?e[t]:g[t]});window.Project=b;const x=b},539:(e,t,a)=>{a.d(t,{$7:()=>m,C6:()=>n.default,Kx:()=>o.default});var s=a(308),i=a(351),n=a(30),o=a(614),r=a(304);const c={PlaneGeometry:s.PlaneGeometry,SphereGeometry:s.SphereGeometry,BoxGeometry:s.BoxGeometry,BufferGeometry:s.BufferGeometry,Group:s.Group,Object3D:s.Object3D,PerspectiveCamera:s.PerspectiveCamera,OrthographicCamera:s.OrthographicCamera,InstancedMesh:s.InstancedMesh,Mesh:s.Mesh,DirectionalLight:s.DirectionalLight,AmbientLight:s.AmbientLight,Color:s.Color,Vector3:s.Vector3,Vector2:s.Vector2,Quaternion:s.Quaternion,Matrix4:s.Matrix4,MeshLambertMaterial:s.MeshLambertMaterial,MeshPhysicalMaterial:s.MeshPhysicalMaterial,MeshStandardMaterial:s.MeshStandardMaterial,BufferAttribute:s.BufferAttribute},l=new i.A,d={block:{module:()=>a.e(314).then(a.bind(a,314)),allowparent:["$root"],denyparent:["block"],allowchild:[],denychild:["block"]},base:{module:()=>Promise.resolve().then(a.bind(a,30))},model:{module:()=>Promise.resolve().then(a.bind(a,614))},camera:{module:()=>a.e(740).then(a.bind(a,740))},alight:{module:()=>a.e(966).then(a.bind(a,966))},uielement:{module:()=>a.e(229).then(a.bind(a,229))},videoplane:{module:()=>a.e(328).then(a.bind(a,328))}},h={},u={};class p{static RegisterElement(e,t,a={}){d[e]={module:t,...a}}static GetType(e){return d[e]}static AddTemplate(e){h[e.id]=element}static AddTemplates(e){e.forEach((e=>{h[e.id]=e}))}static GetElementProp(e,t){let a=u[e];const s=t.split(".");for(let e=0;e<s.length;e++)a=a[s[e]];return a}static async UpdateElement(e,t){const a=u[e];Object.keys(t).forEach((async e=>{a[e]=await p.CreateElement(t[e])}))}static async CreateElement(e){if(null==e)return null;let t=e;if("object"==typeof e){const{type:a,properties:s,asset:i}=e;if(a){let s;const{args:i,...n}=e,o=d[a.toLowerCase()];if(o){const e=await o.module();s=e.default||e}else c[a]&&(s=c[a]);if(Array.isArray(i)){const e=await Promise.all(i.map((e=>p.CreateElement(e))));t=new s(...e)}else t=i?new s(Object.fromEntries(await Promise.all(Object.entries(i).map((async([e,t])=>[e,await p.CreateElement(t)]))))):c[a]?new s:new s(n);if(n.assets?.length){const e=r.A.GetAssets(n.assets.map((e=>e.uid)));t.setAssets(e,n.assets)}t.isObject3D&&(t.isElement||(t.actions=[],t.isElement=!0,t.model=t),t.paths=e.paths,t.path=t.paths.join("."))}else i&&(t=await r.A.GetResource(i));s&&await Promise.all(Object.entries(s).map((async([e,a])=>{t[e]=await p.CreateElement(a)})))}return t}static async BuildElements(e,t){const a=[];for(let s=0;s<e.length;s++){const i=e[s],n=await p.BuildElement(i,t);a.push(n)}return a}static async BuildElement(e,t){if(!t)return;const a=structuredClone(h[e.template]?{...h[e.template],...e}:JSON.parse(JSON.stringify(e))),{uid:s,name:i}=a,n=await p.CreateElement(a);if(n){if(n.uid=s,n.name=i||s,n.path=t.path?`${t.path}.${s}`:s,t){const e=d[n.type.toLowerCase()];if(e?.verifyparent&&!e.verifyparent(t))return;const a=d[t.type.toLowerCase()];if(a?.verifychild&&!a.verifychild(n))return;(t.addChild||t.add).bind(t)(n)}return e.position&&n.position.copy(e.position),e.children&&await p.BuildElements(e.children,n),u[n.uid]=n,n.init&&await n.init(),l.emit("create",n),n}}}const m=new Proxy(p,{get:(e,t)=>t in e?e[t]:l[t]})},586:(e,t,a)=>{a.d(t,{A:()=>c});const s={visible:async function(e,t,a){let s=t;if(e.paths)for(let t=0;t<e.paths.length;t++)s=s[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)s=s.children.find((a=>a.uid===e.target[t]));s.visible=e.value,s.dispatchEvent({target:s,type:"visible",value:s.visible})},propset:function(e,t,a){let s=t;for(let t=0;t<e.paths.length;t++)s=s[e.paths[t]];s[e.property]=e.value}},i={cameraSet:{uid:"cameraSet",type:"func",handler:s.func,paths:["model"],method:"activate",values:{}},visibleSet:{uid:"visibleSet",type:"visible",handler:s.visible,paths:[]},propset:{uid:"propset",type:"propset",handler:s.propset}};async function n(e,t){const a=i[e.uid];await a.handler({...a,...e},t),e.actions&&await o(e.actions,t)}async function o(e,t){const a=[];for(const s of e)a.push(n(s,t));await Promise.all(a)}class r{static get Library(){return i}static Init(e){for(let t=0;t<e.length;t++)r.Add(e[t])}static Add(e){e.handler=s[e.type],i[e.uid]=e}static GetAction(e){return s[e]}static RegisterAction(e,t){console.log(e),s[e]=t,Object.values(i).forEach((t=>{t.type===e&&(t.handler=s[t.type])}))}static async Run(e=[],t,a){const s=e.filter((e=>e.hook===a));0!==s.length&&await o(s,t)}static async Execute(e,t){const a=[];for(let s=0;s<e.length;s++){const i=e[s],n=i.actions?i.actions.filter((e=>e.hook===t)):[];a.push(o(n,i))}await Promise.all(a)}}const c=r},614:(e,t,a)=>{a.r(t),a.d(t,{default:()=>n});var s=a(30);class i extends s.default{constructor(e){super(e),this.isModel=!0,this.type="model"}setAssets(e,t){for(let a=0;a<t.length;a++)this.add(...e.map((e=>e.resource.clone())))}removeAsset(e){const t=this.children.find((t=>t.uid===e));t&&this.remove(t)}addAsset(e,t){t.position.copy(e.transform?.position||{x:0,y:0,z:0}),t.rotation.setFromVector3(e.transform?.rotation||{x:0,y:0,z:0},"XYZ"),t.scale.copy(e.transform?.scale||{x:1,y:1,z:1}),e.transform?.quaternion&&t.quaternion.copy(e.transform?.quaternion),t.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())})),this.add(t)}find(e){const t=e.split(".");let a=this;for(let e=0;e<t.length;e++)a=this.children.find((a=>a.uid===t[e])),list=a.children;return a}}const n=i}}]);