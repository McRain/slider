"use strict";(self.webpackChunk_reneos_3d_editor=self.webpackChunk_reneos_3d_editor||[]).push([[415],{1056:(e,t,a)=>{a.r(t),a.d(t,{actions:()=>m,app:()=>O,assets:()=>f,elements:()=>y.A,engine:()=>i.A,inspector:()=>N,menu:()=>D,modal:()=>r.A,modules:()=>l.A,selection:()=>P.A,slides:()=>g.A,toasts:()=>u.A});var n=a(2655),s=a(9216),o=a(2064),i=a(1915),l=a(7944),r=a(3748);const c=o.default||o;async function d(e){await s.A.upsertItemProperties("actions",e.uid,JSON.parse(JSON.stringify({id:e.uid,...e})))}const p=(0,n.reactive)({init:async function(){const e=await s.A.getAllItems("actions");await i.A.getManager("ActionsManager").Init(e),p.list=e},register:function(e){p.library.push(e)},selectAction:function(){return new Promise((e=>{const t=(0,n.reactive)({selected:null,list:p.list}),a=async()=>{const e=p.library.find((e=>e.component===t.selected.type));Object.keys(e.template).forEach((a=>{t.selected[a]=JSON.parse(JSON.stringify(e.template[a]))})),t.selected.uid=`action${Date.now()}`,p.list.push(t.selected),await d(t.selected),i.label="Выбрать",o=s,c.toasts.add({message:"Действие успешно сохранено"})},s=()=>{r.A.close(),e(t.selected)};let o=()=>{o=a,t.selected={name:"",type:null}};const i=(0,n.reactive)({label:"Создать",class:"primary",handler:async()=>{i.label="Сохранить",o()}}),l=(0,n.reactive)([i,{label:"Отмена",class:"additional",handler:async()=>{r.A.close(),e()}}]);r.A.open({header:{value:"Выберите действие",handler:()=>{r.A.close()}},content:{component:"ItemsLib",props:t,events:{select:e=>{t.selected=e,i.label="Выбрать",o=s}},slots:{item:{component:"ActionItem"},edit:{component:"ActionEdit",props:{selected:t.selected},events:{edit:(e,a)=>{const n=e.split(".");let s=t.selected;for(let e=0;e<n.length-1;e++){const t=n[e];s[t]||(s[t]={}),s=s[t]}s[n[n.length-1]]=a}}}}},footer:{buttons:l}})}))},save:d,showLib:function(){const e=(0,n.reactive)({selected:null,list:p.list}),t=async()=>{const t=p.library.find((t=>t.component===e.selected.type));Object.keys(t.template).forEach((a=>{e.selected[a]=JSON.parse(JSON.stringify(t.template[a]))})),e.selected.uid=`action${Date.now()}`,p.list.push(e.selected),await d(e.selected),o.label="Создать",s=a},a=()=>{s=t,e.selected={name:"",type:null}};let s=a;const o=(0,n.reactive)({label:"Создать",class:"primary",handler:async()=>{o.label="Сохранить",s()}}),i=(0,n.reactive)([o,{label:"Отмена",class:"additional",handler:async()=>{r.A.close(),resolve()}}]);r.A.open({header:{value:"Выберите действие",handler:()=>{r.A.close()}},content:{component:"ItemsLib",props:e,events:{select:a=>{e.selected=a,o.label="Сохранить",s=t}},slots:{item:{component:"ActionItem"},edit:{component:"ActionEdit",props:{selected:e.selected},events:{edit:(t,a)=>{const n=t.split(".");let s=e.selected;for(let e=0;e<n.length-1;e++){const t=n[e];s[t]||(s[t]={}),s=s[t]}s[n[n.length-1]]=a}}}}},footer:{buttons:i}})},hooks:["enable.on","slide.in.before","slide.in","slide.in.after","slide.out.before","slide.out","slide.out.after","disable.on","mouse.in","mouse.click","mouse.out"],addAction(e){p.list[e.uid]=e},parameters:{tween:[{type:"float",name:"delay",default:0},{type:"float",name:"time",default:0}]},list:[],get values(){return Object.values(p.list)},get groups(){return p.library.reduce(((e,t)=>(e.includes(t.type)||e.push(t.type),e)),[])},library:[],async registerActionComponent(e=[]){console.log("registerActionComponent");const t=Object.fromEntries(e.map((e=>[e.id,e.value]))),{name:a,entry:n,ui:s,action:o}=t;l.A.add({name:a,entry:n}),await l.A.load(a,a)},openLib(e){let t=(0,n.reactive)({selected:null});r.A.open({header:{value:"Создать новый исполнитель (action)",handler:()=>{r.A.close(),e()}},content:{component:"ActionsLib",props:t},footer:{buttons:[{label:"Регистрация",handler:()=>{t.selected={}}},{label:"Закрыть",handler:()=>{r.A.close(),e()}}]}})},exportData:()=>JSON.parse(JSON.stringify(p.list))});c.On("init",(()=>{}));const m=p;var u=a(8809);async function h(e,t,a,n){let o=n||function(){};const l=w.list.find((t=>t.uid===e.uid));if(l)Object.keys(e).forEach((t=>{l[t]=e[t]})),await i.A.getAssetsManager().UpdateAsset(e,a.prop,o),await s.A.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e})));else{e.uid=`asset_${Date.now()}`;try{await i.A.getAssetsManager().AddAsset(e,o)}catch(e){return void u.A.add({message:"Ошибка при загрузке ресурса: "+e.message})}w.list.push(e),await s.A.addItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e}))),u.A.add({message:"Ресурс успешно загружен"})}}const w=(0,n.reactive)({init:async function(){const e=await s.A.getAllItems("assets");await i.A.getManager("AssetsManager").Init(e),e.forEach((e=>e.isAsset=!0)),w.list.push(...e)},save:h,updateAsset:async function(e,t,a){await i.A.getAssetsManager().UpdateAsset(e,t,a),await s.A.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e})))},selectAsset:function(e){return new Promise((t=>{const a=(0,n.reactive)({selected:null,list:w.list.filter((t=>!e.includes(t.type)))}),s={label:"Выбрать",class:"secondary",handler:async()=>{t(a.selected),r.A.close()}},o={label:"Регистрация",class:"secondary",handler:async()=>{i.splice(0,1),i.unshift(s),a.selected={name:"",type:w.list.filter((t=>!e.includes(t.type)))[0],url:""}}},i=(0,n.reactive)([o,{label:"Отмена",class:"primary",handler:async()=>{r.A.close(),t()}}]);r.A.open({header:{value:"Выберите ресурс",handler:()=>{r.A.close()}},content:{component:"ItemsLib",props:a,events:{select:e=>{a.selected=e,2===i.length&&i.unshift(s)}},slots:{edit:{component:"AssetEdit",props:{selected:a.selected},events:{edit:(e,t)=>{a.selected[e]=t}}}}},footer:{buttons:i}})}))},editAsset:function(e){const t=(0,n.reactive)({current:e}),a=(0,n.reactive)([{label:"Сохранить",class:"secondary",handler:async()=>{await h(e,0,null,(({loaded:t,total:a})=>{e.progress=t/a*100})),r.A.close()}},{label:"Отмена",class:"primary",handler:async()=>{r.A.close()}}]);r.A.open({header:{value:"Выберите ресурс",handler:()=>{r.A.close()}},content:{component:"AssetEdit",props:t,events:{edit:(t,a)=>{e[t]=a}}},footer:{buttons:a}})},types:["gltf","texture","hdr"],list:[],get assetsTree(){return w.list.reduce(((e,t)=>{let a=e.find((e=>e.type===t.type));return a||(a={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(a)),a.children.push(t),e}),[])},removeAsset(e){const t=w.list.findIndex((t=>t.uid===e.uid));if(t>=0){const e=w.list.splice(t,1);i.A.getAssetsManager().RemoveAsset(e[0])}},exportData:()=>JSON.parse(JSON.stringify(w.list))}),f=w;var y=a(6836),g=a(279);const A=a.p+"5f00000410434e1a50e7.json",v=o.default||o,b=[A];let S;async function E(e,t,a){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const a=t.toDataURL("image/png"),n=document.createElement("a");n.href=a,n.download=`${e}.png`,n.click()}(e,t):async function(e,t={}){try{const a=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let n=new ImageCapture(a);const s=await n.grabFrame(),o=document.createElement("canvas");o.width=s.width,o.height=s.height,o.getContext("2d").drawImage(s,0,0);const i=o.toDataURL("image/png"),l=document.createElement("a");l.href=i,l.download=`${e}.png`,l.click()}catch(e){console.warn(e)}}(e,a)}async function M(e){const t=document.createElement("video");t.height=window.height,t.width=window.width;const a=t.srcObject=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),n=new MediaRecorder(a),s=[];n.ondataavailable=e=>s.push(e.data),n.onerror=e=>{console.warn(e.message)},n.onstop=()=>{const t=new Blob(s,{type:"mp4"});a.getVideoTracks()[0].stop();const n=`${e}.mp4`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,n);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=n,e.style="display: none",e.click()}},n.start()}function I(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const x=(0,n.reactive)({switchScreen:I,captureVideo:M,captureImage:E,init:async function(e){S=e,await s.A.Init(e,["projects","assets","elements","slides","actions","modules"],"uid"),await v.modules.init(),await v.engine.load()},load:async function(){await v.assets.init(),await v.actions.init(),await v.elements.init(),await v.slides.init()},save:async function(){const e={uid:"currproject",id:"currproject",actions:m.exportData(),assets:f.exportData(),elements:y.A.exportData(),slides:g.A.exportData()};return await s.A.updateItem("projects",e),e.uid},LoadExample:async function(e){const t=b[e],a=await fetch(t),n=await a.json(),o=`project${e}`;await s.A.Init(o,["projects","assets","elements","slides","actions","modules"],"uid"),await s.A.addItems("assets",n.assets),await s.A.addItems("elements",n.elements),await s.A.addItems("slides",n.slides);const i=new URL(window.location.href);i.searchParams.set("project",o),window.location.href=i.toString()},importProject:async function(){try{const e=await function(e=".json"){return new Promise((t=>{const a=document.createElement("input");a.type="file",a.accept=e,a.style.display="none",a.addEventListener("change",(()=>{a.files&&a.files[0]&&t(a.files[0]),document.body.removeChild(a)})),document.body.appendChild(a),a.click()}))}(),t=await function(e){return new Promise(((t,a)=>{if(!e.name.endsWith(".json"))return void a(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const a=JSON.parse(e.target.result);t(a)}catch(e){a(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{a(new Error("Ошибка чтения файла"))},n.readAsText(e)}))}(e);let a=!1;const o=(0,n.reactive)({assets:{},elements:{},slides:{}});return r.A.open({header:{value:"Импорт",handler:()=>{r.A.close()}},content:{component:"Importer",props:{project:t},events:{options:e=>{a=e.merge},changelist:e=>{Object.keys(e).forEach((t=>{o[t]=e[t]}))}}},footer:{buttons:[{label:"Импорт",class:"secondary",handler:async()=>{const e=`project${Date.now()}`;await s.A.Init(e,["projects","assets","elements","slides","actions","modules"],"uid"),await s.A.addItems("assets",t.assets),await s.A.addItems("elements",t.elements),await s.A.addItems("slides",t.slides);const a=new URL(window.location.href);a.searchParams.set("project",e),window.location.href=a.toString(),r.A.close()}},{label:"Отмена",class:"primary",handler:async()=>{r.A.close()}}]}}),t}catch(e){throw console.error("Ошибка:",e.message),e}},exportProject:async function(){const e=await async function(){const e=await m.exportData(),t=await f.exportData(),a=await y.A.exportData(),n=await g.A.exportData();return JSON.parse(JSON.stringify({actions:e,assets:t,elements:a,slides:n}))}(),t=new Blob([JSON.stringify(e)],{type:"application/json"}),a="project.json";if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,a);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=a,e.style="display: none",e.click()}},playProject:async function(){x.player=window.open(`../player?src=${S}`,"Player")},ready:!1,cameras:[],player:null,footer:{buttons:[{icon:"camera",tooltip:"Скриншот",handler:E},{icon:"film",tooltip:"Видео",handler:M},{icon:"books",tooltip:"Модули",handler:l.A.openForm},{icon:"enlarge",tooltip:"Экран",handler:I},{icon:"cog",tooltip:"Настройки",handler:E}]}}),O=x,j=[{type:"float",component:a(8475).A}],k={gltf:[{label:"URL",prop:"url",component:"LabelEdit"},{label:"Клонировать",component:"BoolEdit",prop:"clone"},{label:"Создавать тень",component:"BoolEdit",prop:"shadow.cast"},{label:"Получать тень",component:"BoolEdit",prop:"shadow.receive"},{label:"Карта окружения",component:"asset",prop:"envMap"}],DirectLight:[{label:"Трансформ",component:"transformedit"},{label:"Цвет",component:"EditColor",values:{property:"color"}},{label:"Интенсивность",component:"FloatValue",values:{property:"intensity",step:.1,min:0}},{label:"События",component:"ActionsList"},{label:"Видимость",prop:"view",component:"BoolEdit"}],AmbientLight:[{label:"Цвет",component:"EditColor",values:{property:"color"}},{label:"Интенсивность",component:"FloatValue",values:{property:"intensity",step:.1,min:0}},{label:"События",component:"ActionsList"},{label:"Видимость",prop:"view",component:"BoolEdit"}],block:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"},{label:"События",component:"ActionsList"}],model:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"},{label:"Ресурсы",component:"assetsview"},{label:"События",component:"ActionsList"}],PerspectiveCamera:[{label:"Трансформ",component:"transformedit"},{label:"Видимость",prop:"view",component:"BoolEdit"},{label:"FOV",prop:"fov",component:"Int",onupdate(e,t,a,n){e.fov=t,e.updateProjectionMatrix(),e.exportData=function(){return JSON.parse(JSON.stringify({properties:{fov:e.fov,visible:e.visible},name:e.name,uid:e.uid,path:e.path,paths:e.paths,type:e.type}))},n(e)}},{label:"События",component:"ActionsList"}]},N=(0,n.reactive)({ready:!1,cameras:[],getFieldTypes:()=>j,getTypesBlock:e=>k[e]||[]});var L=a(5216);const $=o.default||o;function B(e){L.A.Transformer.setMode(e)}const D=(0,n.reactive)({top:{list:[{icon:"sphere",hint:"Локальное/глобальное пространство",handler:function(){L.A.Transformer.setSpace("local"===L.A.Transformer.space?"world":"local")}},{icon:"move",hint:"Перемещение",handler:B.bind(null,"translate")},{icon:"loop2",hint:"Вращение",handler:B.bind(null,"rotate")},{icon:"enlarge2",hint:"Размер",handler:B.bind(null,"scale")},{icon:"target",hint:"Приблизить выбранное",handler:L.A.FocusToSelect},{icon:"cross",hint:"Снять выделение",handler:()=>{$.selection.select(null)}}],options:{size:"1.5em"}},hierarhy:{list:[{icon:"play3",tooltip:"Запуск",handler:()=>{$.app.playProject()}},{icon:"floppy-disk",tooltip:"Сохранить",handler:()=>{$.app.save()}},{icon:"upload",tooltip:"Экспорт проекта",handler:()=>{$.app.exportProject()}},{icon:"download",tooltip:"Импорт проекта",handler:()=>{$.app.importProject()}},{icon:"pacman",tooltip:"Пример 1",handler:()=>{$.app.LoadExample(0)}},{icon:"sphere",tooltip:"Локальное/глобальное пространство",handler:()=>{$.actions.showLib()}}],options:{}}});var P=a(9391)},1291:(e,t,a)=>{e.exports=a.p+"assets/1a5b97390f32f320a30b.svg"},1915:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(2655),s=a(7944);let o;const i={},l=[],r=(0,n.reactive)({ready:!1,getAssetsManager:()=>i.AssetsManager,getSlidesManager:()=>i.SlidesManager,getFactory:()=>i.Factory,getManager:e=>i[e]||o,async load(){const{AssetsManager:e,CssManager:t,MouseManager:a,ActionsManager:n,ElementModel:c,ProjectManager:d,SlidesManager:p,Factory:m,Manager:u,assets:h}=await s.A.load("engine","engine");i.AssetsManager=e,i.SlidesManager=p,i.Factory=m,i.MouseManager=a,i.ActionsManager=n,i.CssManager=t,o=d,r.ready=!0;const w=[];for(let e=0;e<l.length;e++)w.push(l[e](o));return l.length=0,await Promise.all(w),o},onload(e){l.push(e)}}),c=r},2215:(e,t,a)=>{a.d(t,{A:()=>u});var n=a(2655);const s={class:"app-container canvas-container"},o={id:"editorcanvas",ref:"editorcanvas"},i={id:"playcanvas",ref:"playcanvas"},l={class:"absoluteClass",style:{"pointer-events":"none"},ref:"uiroot"};var r=a(4435),c=a(3822),d=a(125);const p={},m={data:()=>({selectedElement:null,elements:[]}),computed:{hierarhyAllow(){return this.$app.engine.instances.length>0},options(){return this.$app.options},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.engine.ready},toasts(){return this.$app.toasts},modal(){return this.$app.modal},translations(){return this.$app.translations}},methods:{onElementMount(e,t){p[t]&&(p[t](e),delete p[t])},addElement(e){return new Promise((t=>{this.elements.push({component:"UILabel",ref:e.path,data:{...e,visible:!1}}),p[e.path]=t}))},waitCanvasSize(e){const t=window.devicePixelRatio||1;e.forEach((e=>{e.width=e.clientWidth*t,e.height=e.clientHeight*t}))},slideSwitch(e){}},async mounted(){document.documentElement.setAttribute("data-theme","dark");const e=this.$refs.editorcanvas,t=this.$refs.playcanvas;this.waitCanvasSize([e,t]);const a=window.location.search,n=new URLSearchParams(a);window.THREE=d,await this.$app.app.init(n.get("project")||"editor");const s=this.$app.engine.getManager();await s.Init(t),await s.Start(),await this.$app.app.load(),this.$app.engine.getManager("SlidesManager").GoTo(0),await c.A.Init(e),this.app.ready=!0},components:{UI:r.A}},u=(0,a(6262).A)(m,[["render",function(e,t,a,r,c,d){const p=(0,n.resolveComponent)("UI"),m=(0,n.resolveComponent)("Modal"),u=(0,n.resolveComponent)("Toasts");return(0,n.openBlock)(),(0,n.createElementBlock)("div",s,[(0,n.createElementVNode)("canvas",o,null,512),(0,n.createElementVNode)("canvas",i,null,512),(0,n.createVNode)(p,{onSwitchslide:d.slideSwitch,element:c.selectedElement},null,8,["onSwitchslide","element"]),(0,n.createElementVNode)("div",l,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(c.elements,((e,t)=>((0,n.openBlock)(),(0,n.createBlock)((0,n.resolveDynamicComponent)(e.component),{onMounted:d.onElementMount,key:t,modelValue:e.data,"onUpdate:modelValue":t=>e.data=t},null,40,["onMounted","modelValue","onUpdate:modelValue"])))),128))],512),d.modal.isVisible?((0,n.openBlock)(),(0,n.createBlock)(m,{key:0})):(0,n.createCommentVNode)("v-if",!0),(0,n.createVNode)(u)])}]])},3748:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(2655);const s=(0,n.ref)(!1),o=(0,n.reactive)({isVisible:!1,header:null,content:null,footer:null,values:null,open({header:e,content:t,footer:a,...n}){o.header=e||{},o.content=t||{},o.footer=a||{},o.values={closable:!1,...n},s.value=!0},close(e){e||(s.value=!1)},get isVisible(){return s.value}}),i=o},6836:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(2655),s=a(9216),o=a(1915),i=a(9391);async function l(e){const t=r.list.find((t=>t.uid===e.paths[0])).exportData();await s.A.updateItem("elements",{id:t.uid,...t})}const r=(0,n.reactive)({init:async function(){const e=await s.A.getAllItems("elements");if(0===e.length){const t={uid:"camroot",type:"block",path:"camroot",paths:["camroot"],children:[{uid:"maincam",type:"PerspectiveCamera",path:"camroot.maincam",paths:["camroot","maincam"]}]};e.push(t),await s.A.addItem("elements",{id:t.uid,...t})}const t=await o.A.getManager().Build(e);for(let e=0;e<t.length;e++){const a=t[e],s=(0,n.reactive)(a);r.list.push(s)}},create:async function(e,t){let a;if(t){let e=r.list;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];a=e.find((e=>e.uid===s)),e=a.children}}const n=await o.A.getManager("Factory").BuildElement(e,a||o.A.getManager().Root),i=n.exportData();n.isBlock?(r.list.push(n),await s.A.addItem("elements",{id:i.uid,...i})):(t.data.children.push(n.data),l(n.data))},edit:function(e,t,a){t in e||(e[t]=a,(0,n.watch)((()=>e[t]),(a=>{e.model[t]=a}))),e.data[t]=e[t]=e.model[t]=a,l(e)},remove:async function(e){if(i.A.selected===e&&i.A.select(null),e.isBlock){slides.removeState(e.uid);const t=r.list.findIndex((t=>t.uid===e.uid));t>=0&&r.list.splice(t,1),await s.A.deleteItem("elements",e.uid)}else{const t=e.parent;t.remove(e);const a=t.data.children.findIndex((t=>t.uid===e.uid));a>=0&&t.data.children.splice(a,1),l(t)}},findElement:function(e){let t=r,a=r.list;for(let n=0;n<e.length;n++)t=a.find((t=>t.uid===e[n])),a=t.children;return t},save:l,exportData:function(){const e=r.list.map((e=>e.exportData()));return JSON.parse(JSON.stringify(e))},addAsset:async function(e,t){e.assets||(e.assets=[]),e.assets.push({uid:t.uid}),e.model.setAsset(t),e.model.data.assets||(e.model.data.assets=[]),e.model.data.assets.push({uid:t.uid}),await l(e)},removeAsset:async function(e,t){e.model.removeAsset(t.uid);const a=e.data.assets.findIndex((e=>e.uid===t.uid));a>=0&&e.data.assets.splice(a,1),await l(e)},types:["block","model","camera","DirectionalLight","AmbientLight"],list:[]}),c=r},7944:(e,t,a)=>{a.d(t,{A:()=>p});var n=a(2655),s=a(3949),o=a(9216),i=a(8809),l=a(3748);const r=[{name:"engine",entry:"/editor/engine/mf.js",index:"engine"},{name:"tweens",entry:"../mods/tweens/mf.js",index:"tweens"}],c=[];const d=(0,n.reactive)({init:async function(){c.length=0,await(0,s.registerRemotes)([...r,...d.remotes.map((e=>({name:e.scope,entry:e.url})))]);const e=r.map((e=>new Promise((t=>{(0,s.loadRemote)(`${e.name}/${e.index}`).then((a=>{c.push({module:a,name:e.name,index:e.index,entry:e.entry}),t()}))}))));await Promise.all(e),await async function(){const e=await o.A.getAllItems("modules");await(0,s.registerRemotes)(e);const t=e.map((e=>new Promise((t=>{(0,s.loadRemote)(`${e.name}/${e.index}`).then((a=>{c.push({module:a,name:e.name,index:e.index,entry:e.entry}),t()}))}))));await Promise.all(t)}()},openForm:function(){let e=(0,n.ref)(null);const t={label:"Сохранить",class:"secondary",handler:async()=>{try{await async function(e){(0,s.registerRemotes)([e]),await(0,s.loadRemote)(`${e.name}/${e.index}`),await async function(e){await o.A.upsertItemProperties("modules",e.index,{id:e.index,...e})}(e)}(e.value)}catch(e){return void i.A.add({message:"Ошибка при загрузке модуля"})}i.A.add({message:"Модуль успешно загружен"}),l.A.close()}},a={label:"Регистрация",class:"secondary",handler:async()=>{r.splice(0,1),r.unshift(t),e.value={name:"ModuleName"}}},r=(0,n.reactive)([a,{label:"Отмена",class:"primary",handler:async()=>{l.A.close()}}]);l.A.open({header:{value:"Управление модулями",handler:()=>{l.A.close()}},content:{component:"ItemsLib",props:{list:c,selected:e},events:{select:t=>e.value=t},slots:{edit:{component:"ModuleEdit",props:{selected:e.value},events:{edit:(t,a)=>{e.value[t]=a}}}}},footer:{buttons:r}})},remotes:[],async save(){await IndexedDBManager.updateItem(STORENAME_OPTS,{id:"extensions.remotes",value:JSON.parse(JSON.stringify(d.remotes))})},async load(e,t){const a=await(0,s.loadRemote)(`${e}/${t}`);return a.default||a},loads:async e=>(await Promise.allSettled(e.map((e=>(0,s.loadRemote)(`${e.scope}/${e.module}`))))).map((e=>e.default||e))}),p=d}}]);