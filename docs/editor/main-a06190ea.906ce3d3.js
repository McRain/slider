"use strict";(self.webpackChunk_reneos_3d_editor=self.webpackChunk_reneos_3d_editor||[]).push([[716],{3822:(e,t,n)=>{n.d(t,{A:()=>P});var a=n(2064),s=n(5216),o=n(125);const i=new o.Raycaster,c=new class{constructor(){this._events={"*":[]}}subs(e,t,n){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:n,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const n=this._events[e];if(n){for(let e=n.length-1;e>=0;e--)n[e].handler===t&&n.splice(e,1);0===n.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const n=[];this._events[e]&&n.push(...this._events[e]),this._events["*"].length&&n.push(...this._events["*"].map((t=>({handler:t.handler.bind(this,e),once:t.once}))));for(let e=n.length-1;e>=0;e--){const a=n[e];a.handler.apply(null,t),a.once&&n.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};let r,l,d,p;const h={x:0,y:0};let u,m=.03,g=.03,w=.01,v=.01,y=window.innerWidth/2,b=window.innerHeight/2;function f(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}function S(e){}function k(e){h.x=e.clientX,h.y=e.clientY,u=Date.now()}function _(e){if(Math.abs(h.x-e.clientX)>10||Math.abs(h.y-e.clientY)>10||Date.now()-u>500)return;const t=new o.Vector2,n=p.getBoundingClientRect(),a=e.clientX-n.left,s=e.clientY-n.top;t.x=a/p.clientWidth*2-1,t.y=-s/p.clientHeight*2+1,i.setFromCamera(t,l);const d=i.intersectObjects(r.children,!0);if(0!==d.length)for(let e=0;e<d.length;e++){const t=f(d[e].object);if(t.visible)return void c.emit("click",t)}else c.emit("click",null)}const x=new Proxy(class{static get Control(){return Control}static Init(e,t,n,a,s){const o={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...s};r=a,d=n,l=t,p=e,m=o.camera.movespeed.x,g=o.camera.movespeed.y,w=o.camera.range.x,v=o.camera.range.y,y=window.innerWidth/2,b=window.innerHeight/2,e.addEventListener("click",_.bind(null)),e.addEventListener("mousemove",S,!1),e.addEventListener("mousedown",k,!1)}static Update(e){}static SetCamera(e){l=e}},{get:(e,t)=>t in e?e[t]:c[t]}),C=a.default||a;let E,R,T,K;function M(e){R.render(E,T)}const P=class{static async Init(e){K=e;const{THREE:t,ProjectManager:n}=await C.modules.load("engine","engine");E=n.Scene,R=new t.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const a=K.clientWidth,o=K.clientHeight;R.setSize(a,o,!1),R.setPixelRatio(window.devicePixelRatio);const i=new t.CameraHelper(n.Camera);i.layers.set(1),E.add(i),T=new t.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,5e3),T.uid="EditorCamera",E.add(T),T.position.set(5,3,20),R.setAnimationLoop(M),T.layers.enable(1),s.A.Init({canvas:K},T,n.Scene),s.A.FocusTo(n.Root),x.Init(K,T,E,n.Root),x.on("click",(e=>{C.selection.select(e)}))}}},5216:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(7024),s=n(125),o=n(5e3),i=n(9338);let c,r,l;class d{static FocusTo(e){c.target.copy(e.isObject3D?e.position:e)}static MoveTo(e,t){const n={position:new s.Vector3,time:1e3,...e,control:!1},a={position:new s.Vector3,time:1e3,...t,control:!1};c.enabled=!1;const o=Workspace.Camera.position.clone(),i=c.target.clone();n.control=n.time>a.time,a.control=a.time>=n.time;const r=new Tween(o).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{Workspace.Camera.position.copy(o),Workspace.Camera.updateProjectionMatrix(),c.update()})).onComplete((()=>{n.control&&(c.enabled=!0),tweengroup.remove(r)})).start(),l=new Tween(i).to(a.position,a.time).easing(Easing.Quadratic.InOut).onUpdate((()=>{c.target.copy(i),c.getPolarAngle()>c.maxPolarAngle&&c.target.setY(center.y+Math.cos(c.maxPolarAngle)*distance)})).onComplete((()=>{a.control&&(c.enabled=!0),tweengroup.remove(l)})).start();tweengroup.add(r,l)}static SetState(e){c.enabled=e}static Init({canvas:e},t,n){l=t,c=new a.N(t,e),c.enabled=!0,c.enableDamping=!0,c.dampingFactor=.25,c.screenSpacePanning=!1,c.minDistance=.01,c.maxDistance=500,r=new o.ZU(t,e),r.addEventListener("dragging-changed",(e=>{c.enabled=!e.value}));const i=r.getHelper();n.add(i),r.getRaycaster().layers.set(1),i.traverse((e=>{e.layers.set(1)})),window.addEventListener("keydown",(e=>{switch(c.enabled=!e.ctrlKey,e.code){case"KeyQ":r.setSpace("local"===r.space?"world":"local");break;case"Shift":r.setTranslationSnap(1),r.setRotationSnap(s.MathUtils.degToRad(15)),r.setScaleSnap(.25);break;case"KeyW":r.setMode("translate");break;case"KeyE":r.setMode("rotate");break;case"KeyR":r.setMode("scale");break;case"KeyF":r.object&&function(e){if(!e.object)return void console.warn("Нет выбранного объекта в TransformControls!");const t=e.object,n=new s.Box3;t.traverse((e=>{n.expandByObject(e)}));const a=new s.Sphere;n.getBoundingSphere(a),d.FitTo(a)}(r);break;case"KeyC":case"KeyV":case"KeyX":case"KeyY":case"KeyZ":case" ":case"Escape":break;case"+":case"=":r.setSize(r.size+.1);break;case"-":case"_":r.setSize(Math.max(r.size-.1,.1))}})),window.addEventListener("keyup",(e=>{c.enabled=!e.ctrlKey,"Shift"===e.key&&(r.setTranslationSnap(null),r.setRotationSnap(null),r.setScaleSnap(null))}))}static get Transformer(){return r}static Select(e){e?r.attach(e):r.detach()}static Update(e){c.update(e)}static FitTo({center:e,radius:t}){const n=(0,i.eh)(l.fov),a=t/Math.sin(n/2),o=(new s.Vector3).subVectors(l.position,e).normalize(),r=e.clone().add(o.multiplyScalar(a));l.position.clone(),c.enabled=!1,c.target.clone(),function(e,t,n=1){const a=n,s=l.position.clone(),o=c.target.clone(),i=Date.now();!function n(){const r=(Date.now()-i)/(1e3*a);if(r>=1)return l.position.copy(e),c.target.copy(t),void c.update();l.position.lerpVectors(s,e,r),c.target.lerpVectors(o,t,r),c.update(),requestAnimationFrame(n)}()}(r,e,.5)}}const p=d}}]);